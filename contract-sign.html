<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TimberNova — Contract</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { margin:0; background:#020617; color:#f9fafb; font-family:system-ui,sans-serif; display:flex; flex-direction:column; min-height:100vh; }
    header, footer { padding:16px 24px; background:rgba(2,6,23,0.9); border-bottom:1px solid rgba(148,163,184,0.3); display:flex; justify-content:space-between; align-items:center; }
    footer { border-top:1px solid rgba(148,163,184,0.3); border-bottom:none; margin-top:auto; }
    nav a { color:#9ca3af; text-decoration:none; margin-left:12px; font-size:14px; padding:6px 10px; border-radius:999px; }
    nav a:hover { background:rgba(148,163,184,0.2); color:#e5e7eb; }
    main { padding:24px; max-width:900px; margin:0 auto; flex:1; }
    h1 { font-size:22px; margin-bottom:8px; }
    .sub { color:#9ca3af; font-size:14px; margin-bottom:20px; }
    .contract-doc { border-radius:16px; border:1px solid rgba(148,163,184,0.3); background:rgba(15,23,42,0.95); padding:20px; font-size:14px; line-height:1.6; }
    .section-title { font-weight:600; margin-top:12px; margin-bottom:4px; }
    .sig-blocks { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:20px; }
    @media (max-width:700px){ .sig-blocks{grid-template-columns:1fr;} }
    .sig-box { border-radius:12px; border:1px solid rgba(148,163,184,0.4); padding:10px; }
    .sig-line { margin-top:18px; border-top:1px solid rgba(148,163,184,0.5); padding-top:6px; font-size:13px; }
    .sig-name { font-family:"Pacifico","Segoe Script","Brush Script MT",cursive; font-size:20px; color:#bbf7d0; }
    .sig-input { width:100%; border-radius:10px; border:1px solid rgba(148,163,184,0.6); background:rgba(15,23,42,0.9); color:#e5e7eb; padding:6px 8px; font-size:13px; margin-top:6px; }
    .actions { margin-top:16px; display:flex; justify-content:space-between; align-items:center; }
    .actions button { border:none; border-radius:999px; padding:8px 14px; font-size:13px; cursor:pointer; }
    .btn-primary { background:linear-gradient(120deg,#22c55e,#4ade80); color:#022c22; }
    .btn-ghost { background:rgba(15,23,42,0.9); color:#e5e7eb; border:1px solid rgba(148,163,184,0.5); }
    .status { font-size:12px; color:#9ca3af; margin-top:6px; }
  </style>
</head>
<body>
  <header>
    <div>TimberNova • Contract</div>
    <nav>
      <a href="dashboard.html">Dashboard</a>
      <a href="contracts.html">Contracts</a>
      <a href="calendar.html">Calendar</a>
      <a href="trees.html">Trees</a>
      <a href="network.html">Network</a>
      <a href="stores.html">Stores</a>
      <a href="calls.html">Calls</a>
      <a href="#" id="logout">Logout</a>
    </nav>
  </header>

  <main>
    <h1>Contract</h1>
    <div class="sub" id="subText"></div>

    <div class="contract-doc" id="contractDoc"></div>

    <div class="actions">
      <button class="btn-ghost" id="backBtn">Back to contracts</button>
      <button class="btn-primary" id="signBtn">Sign as TimberNova</button>
    </div>
    <div class="status" id="statusMsg"></div>
  </main>

  <footer>TimberNova • Contracts</footer>

  <script>
    if (!localStorage.getItem("timberNovaUser")) window.location.href = "index.html";
    document.getElementById("logout").onclick = () => { localStorage.removeItem("timberNovaUser"); window.location.href="index.html"; };

    const params = new URLSearchParams(window.location.search);
    const contractId = params.get("id");
    const mode = params.get("mode") || "view";

    const subText = document.getElementById("subText");
    const docEl = document.getElementById("contractDoc");
    const signBtn = document.getElementById("signBtn");
    const backBtn = document.getElementById("backBtn");
    const statusMsg = document.getElementById("statusMsg");

    function loadContracts() {
      try { return JSON.parse(localStorage.getItem("timberNovaContracts") || "[]"); }
      catch { return []; }
    }
    function saveContracts(contracts) {
      localStorage.setItem("timberNovaContracts", JSON.stringify(contracts));
    }

    const contracts = loadContracts();
    const contract = contracts.find(c => c.id === contractId);

    if (!contract) {
      docEl.innerHTML = "<div style='color:#fecaca;'>Contract not found.</div>";
      signBtn.disabled = true;
    } else {
      const created = new Date(contract.createdAt).toLocaleDateString();
      const due = contract.dueDate ? new Date(contract.dueDate).toLocaleDateString() : "N/A";
      subText.textContent = `${contract.clientName} • ${contract.jobAddress} • Created ${created}`;

      docEl.innerHTML = `
        <div><strong>Client:</strong> ${contract.clientName} (${contract.clientEmail})</div>
        <div><strong>Job address:</strong> ${contract.jobAddress}</div>
        <div><strong>Price:</strong> $${contract.price}</div>
        <div><strong>Job completion date:</strong> ${due}</div>

        <div class="section-title">Scope of work</div>
        <div>${contract.jobDescription.replace(/\n/g,"<br/>")}</div>

        <div class="section-title">Terms</div>
        <div>${contract.terms.replace(/\n/g,"<br/>")}</div>

        <div class="section-title">Signatures</div>
        <div class="sig-blocks">
          <div class="sig-box">
            <div><strong>TimberNova representative</strong></div>
            <div class="sig-line">
              <div class="sig-name" id="adminSigName">${contract.adminSignature || ""}</div>
              <div style="font-size:11px;color:#9ca3af;">Signed by TimberNova</div>
            </div>
          </div>
          <div class="sig-box">
            <div><strong>Client</strong></div>
            <div class="sig-line">
              <div class="sig-name" id="clientSigName">${contract.clientSignature || ""}</div>
              <div style="font-size:11px;color:#9ca3af;">Signed by client</div>
            </div>
          </div>
        </div>
      `;
    }

    if (mode !== "admin") {
      signBtn.style.display = "none";
    }

    backBtn.onclick = () => {
      window.location.href = "contracts.html";
    };

    signBtn.onclick = () => {
      if (!contract) return;
      const name = prompt("Type your full name to sign as TimberNova:");
      if (!name) return;

      contract.adminSignature = name;
      if (contract.status === "Draft") contract.status = "Draft"; // still draft until sent
      saveContracts(contracts);

      document.getElementById("adminSigName").textContent = name;
      statusMsg.textContent = "Signature captured. Contract is ready to send to the client.";
    };
  </script>
</body>
</html>
